<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>Notes App</title> <style> * { margin: 0; padding: 0; box-sizing: border-box; } body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; } .container { max-width: 1200px; margin: 0 auto; } .header { background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 5px 15px rgba(0,0,0,0.1); } .header h1 { color: #333; font-size: 28px; } .auth-section { display: flex; gap: 10px; align-items: center; } .auth-section input { padding: 10px; border: 1px solid #ddd; border-radius: 5px; width: 150px; } .auth-section button { padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; } .auth-section button:hover { background: #5568d3; } .logout-btn { background: #ff4757; } .logout-btn:hover { background: #ff3838; } .hidden { display: none !important; } .main-content { display: grid; grid-template-columns: 280px 1fr; gap: 20px; } .sidebar { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); height: fit-content; max-height: 600px; overflow-y: auto; } .sidebar h3 { margin-bottom: 15px; color: #333; font-size: 18px; border-bottom: 2px solid #667eea; padding-bottom: 10px; } .category-item { padding: 12px; margin: 5px 0; background: #f0f0f0; border-radius: 5px; cursor: pointer; border-left: 4px solid transparent; transition: all 0.3s ease; } .category-item:hover { background: #e0e0e0; border-left-color: #667eea; } .category-item.active { background: #667eea; color: white; border-left-color: #5568d3; } .add-category-btn { width: 100%; padding: 10px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; margin-top: 15px; } .add-category-btn:hover { background: #5568d3; } .notes-section { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); } .notes-section h2 { margin-bottom: 20px; color: #333; font-size: 24px; } .add-note-form { margin-bottom: 30px; padding: 20px; background: #f9f9f9; border-radius: 8px; border: 1px solid #eee; } .form-group { margin-bottom: 15px; } .form-group label { display: block; margin-bottom: 5px; color: #333; font-weight: bold; } .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px; font-family: inherit; font-size: 14px; } .form-group textarea { resize: vertical; min-height: 100px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; } .form-group input:focus, .form-group textarea:focus, .form-group select:focus { outline: none; border-color: #667eea; box-shadow: 0 0 5px rgba(102, 126, 234, 0.5); } .form-buttons { display: flex; gap: 10px; } .btn-add { padding: 12px 25px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 14px; } .btn-add:hover { background: #5568d3; } .message-box { margin-bottom: 20px; padding: 15px; border-radius: 5px; display: none; } .message-box.error { background: #ffe0e0; color: #ff4757; border: 1px solid #ff4757; display: block; } .message-box.success { background: #e0ffe0; color: #2ed573; border: 1px solid #2ed573; display: block; } .notes-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; } .note-card { background: linear-gradient(135deg, #f5f7fa 0%, #f9fafb 100%); padding: 20px; border-radius: 8px; border-left: 5px solid #667eea; position: relative; box-shadow: 0 2px 10px rgba(0,0,0,0.05); transition: all 0.3s ease; } .note-card:hover { box-shadow: 0 5px 20px rgba(0,0,0,0.1); transform: translateY(-2px); } .note-card h4 { color: #333; margin-bottom: 10px; font-size: 16px; word-break: break-word; } .note-card p { color: #666; line-height: 1.6; word-break: break-word; max-height: 100px; overflow: hidden; margin-bottom: 10px; } .note-category { display: inline-block; background: #667eea; color: white; padding: 4px 10px; border-radius: 20px; font-size: 12px; margin-bottom: 10px; } .note-actions { margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap; } .note-actions button { padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: bold; transition: all 0.3s ease; } .btn-delete { background: #ff4757; color: white; } .btn-delete:hover { background: #ff3838; } .empty-state { text-align: center; padding: 40px; color: #999; } .empty-state p { font-size: 16px; } </style> </head> <body> <div class="container"> <!-- Header --> <div class="header"> <h1>üìù My Notes</h1> <div id="authSectionUI" class="auth-section"> <input type="email" id="email" placeholder="Email" /> <input type="password" id="password" placeholder="Password" /> <button onclick="handleSignup()">Signup</button> <button onclick="handleLogin()">Login</button> </div> <button class="logout-btn hidden" id="logoutBtn" onclick="handleLogout()">Logout</button> </div>
text
    <!-- Main Content -->
    <div class="main-content hidden" id="mainContent">
        <!-- Sidebar -->
        <div class="sidebar">
            <h3>üìÇ Categories</h3>
            <div class="category-item active" onclick="filterByCategory(null)">All Notes</div>
            <div id="categoryList"></div>
            <button class="add-category-btn" onclick="promptAddCategory()">+ Add Category</button>
        </div>

        <!-- Notes Section -->
        <div class="notes-section">
            <h2>Your Notes</h2>
            
            <div class="add-note-form">
                <div class="form-group">
                    <label for="noteTitle">Title</label>
                    <input type="text" id="noteTitle" placeholder="Enter note title..." />
                </div>
                <div class="form-group">
                    <label for="noteContent">Content</label>
                    <textarea id="noteContent" placeholder="Enter note content..."></textarea>
                </div>
                <div class="form-group">
                    <label for="noteCategory">Category</label>
                    <select id="noteCategory">
                        <option value="">No Category</option>
                    </select>
                </div>
                <div class="form-buttons">
                    <button class="btn-add" onclick="handleAddNote()">+ Add Note</button>
                </div>
            </div>

            <div id="messageBox" class="message-box"></div>
            <div id="notesList" class="notes-list"></div>
        </div>
    </div>
</div>

<script>
    // ========== CONFIGURATION ==========
    const API_BASE = window.location.hostname === 'localhost' 
        ? 'http://localhost:3001' 
        : window.location.origin.replace(/:[0-9]+$/, '');
    
    let token = localStorage.getItem('token');
    let userId = localStorage.getItem('userId');
    let currentCategoryId = null;

    // Check if already logged in
    if (token && userId) {
        showApp();
    }

    // ========== AUTH FUNCTIONS ==========
    async function handleSignup() {
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value.trim();

        if (!email || !password) {
            showError('Please fill in both email and password');
            return;
        }

        try {
            const response = await fetch(`${API_BASE}/auth/signup`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
            });

            const data = await response.json();

            if (!response.ok) {
                showError(data.error || 'Signup failed');
                return;
            }

            token = data.token;
            userId = data.user.id;
            localStorage.setItem('token', token);
            localStorage.setItem('userId', userId);
            showSuccess('Signup successful!');
            showApp();
        } catch (error) {
            showError('Signup error: ' + error.message);
            console.error('Signup error:', error);
        }
    }

    async function handleLogin() {
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value.trim();

        if (!email || !password) {
            showError('Please fill in both email and password');
            return;
        }

        try {
            const response = await fetch(`${API_BASE}/auth/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
            });

            const data = await response.json();

            if (!response.ok) {
                showError(data.error || 'Login failed');
                return;
            }

            token = data.token;
            userId = data.user.id;
            localStorage.setItem('token', token);
            localStorage.setItem('userId', userId);
            showSuccess('Login successful!');
            showApp();
        } catch (error) {
            showError('Login error: ' + error.message);
            console.error('Login error:', error);
        }
    }

    function handleLogout() {
        token = null;
        userId = null;
        currentCategoryId = null;
        localStorage.removeItem('token');
        localStorage.removeItem('userId');
        document.getElementById('authSectionUI').classList.remove('hidden');
        document.getElementById('logoutBtn').classList.add('hidden');
        document.getElementById('mainContent').classList.add('hidden');
        document.getElementById('email').value = '';
        document.getElementById('password').value = '';
        clearMessages();
    }

    function showApp() {
        document.getElementById('authSectionUI').classList.add('hidden');
        document.getElementById('logoutBtn').classList.remove('hidden');
        document.getElementById('mainContent').classList.remove('hidden');
        loadNotes();
        loadCategories();
    }

    // ========== NOTES FUNCTIONS ==========
    async function loadNotes() {
        if (!token) return;

        try {
            const url = currentCategoryId 
                ? `${API_BASE}/api/notes?categoryId=${currentCategoryId}`
                : `${API_BASE}/api/notes`;

            const response = await fetch(url, {
                headers: { 'Authorization': `Bearer ${token}` }
            });

            if (response.status === 401) {
                handleLogout();
                return;
            }

            const notes = await response.json();
            displayNotes(notes);
        } catch (error) {
            showError('Error loading notes: ' + error.message);
            console.error('Load notes error:', error);
        }
    }

    function displayNotes(notes) {
        const notesList = document.getElementById('notesList');

        if (notes.length === 0) {
            notesList.innerHTML = '<div class="empty-state"><p>üì≠ No notes yet. Create your first note!</p></div>';
            return;
        }

        notesList.innerHTML = notes.map(note => `
            <div class="note-card">
                <h4>${escapeHtml(note.title)}</h4>
                ${note.category ? `<div class="note-category">${escapeHtml(note.category.name)}</div>` : ''}
                <p>${escapeHtml(note.content)}</p>
                <div class="note-actions">
                    <button class="btn-delete" onclick="handleDeleteNote('${note.id}')">Delete</button>
                </div>
            </div>
        `).join('');
    }

    async function handleAddNote() {
        const title = document.getElementById('noteTitle').value.trim();
        const content = document.getElementById('noteContent').value.trim();
        const categoryId = document.getElementById('noteCategory').value || null;

        if (!title || !content) {
            showError('Title and content are required');
            return;
        }

        try {
            const response = await fetch(`${API_BASE}/api/notes`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({ title, content, categoryId: categoryId ? parseInt(categoryId) : null })
            });

            if (!response.ok) {
                const err = await response.json();
                showError(err.error || 'Failed to add note');
                return;
            }

            showSuccess('Note added successfully!');
            document.getElementById('noteTitle').value = '';
            document.getElementById('noteContent').value = '';
            loadNotes();
        } catch (error) {
            showError('Error adding note: ' + error.message);
            console.error('Add note error:', error);
        }
    }

    async function handleDeleteNote(noteId) {
        if (!confirm('Are you sure you want to delete this note?')) return;

        try {
            const response = await fetch(`${API_BASE}/api/notes/${noteId}`, {
                method: 'DELETE',
                headers: { 'Authorization': `Bearer ${token}` }
            });

            if (!response.ok) {
                showError('Failed to delete note');
                return;
            }

            showSuccess('Note deleted!');
            loadNotes();
        } catch (error) {
            showError('Error deleting note: ' + error.message);
            console.error('Delete error:', error);
        }
    }

    // ========== CATEGORY FUNCTIONS ==========
    async function loadCategories() {
        if (!token) return;

        try {
            const response = await fetch(`${API_BASE}/api/categories`, {
                headers: { 'Authorization': `Bearer ${token}` }
            });

            const categories = await response.json();
            displayCategories(categories);
        } catch (error) {
            console.error('Error loading categories:', error);
        }
    }

    function displayCategories(categories) {
        const categoryList = document.getElementById('categoryList');
        const categorySelect = document.getElementById('noteCategory');

        categoryList.innerHTML = categories.map(cat => `
            <div class="category-item" onclick="filterByCategory(${cat.id})">${escapeHtml(cat.name)}</div>
        `).join('');

        categorySelect.innerHTML = '<option value="">No Category</option>' +
            categories.map(cat => `<option value="${cat.id}">${escapeHtml(cat.name)}</option>`).join('');
    }

    async function handleAddCategory(name) {
        if (!name || !name.trim()) {
            showError('Category name cannot be empty');
            return;
        }

        try {
            const response = await fetch(`${API_BASE}/api/categories`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({ name: name.trim() })
            });

            if (!response.ok) {
                const err = await response.json();
                showError(err.error || 'Failed to add category');
                return;
            }

            showSuccess('Category added!');
            loadCategories();
        } catch (error) {
            showError('Error adding category: ' + error.message);
            console.error('Add category error:', error);
        }
    }

    function filterByCategory(categoryId) {
        currentCategoryId = categoryId;
        document.querySelectorAll('.category-item').forEach(el => el.classList.remove('active'));
        
        if (categoryId === null) {
            document.querySelector('.category-item').classList.add('active');
        } else {
            event.target.classList.add('active');
        }

        loadNotes();
    }

    function promptAddCategory() {
        const name = prompt('Enter category name:');
        if (name) handleAddCategory(name);
    }

    // ========== UTILITY FUNCTIONS ==========
    function showError(msg) {
        const box = document.getElementById('messageBox');
        box.textContent = msg;
        box.className = 'message-box error';
        setTimeout(() => clearMessages(), 4000);
    }

    function showSuccess(msg) {
        const box = document.getElementById('messageBox');
        box.textContent = msg;
        box.className = 'message-box success';
        setTimeout(() => clearMessages(), 3000);
    }

    function clearMessages() {
        const box = document.getElementById('messageBox');
        box.textContent = '';
        box.className = 'message-box';
    }

    function escapeHtml(text) {
        const map = {
            '&': '&amp;',
            '<': '&lt;',
            '>': '&gt;',
            '"': '&quot;',
            "'": '&#039;'
        };
        return text.replace(/[&<>"']/g, m => map[m]);
    }
</script>
</body> </html>